<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Confirmation - SportLaze</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }
        
        .logo {
            width: 120px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #4a2d8b;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .status {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .reference {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 15px 0;
            word-break: break-all;
        }
        
        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(74, 45, 139, 0.3);
            border-radius: 50%;
            border-top-color: #4a2d8b;
            animation: spin 1s ease-in-out infinite;
            margin: 20px 0;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .success-icon, .error-icon {
            font-size: 60px;
            margin: 20px 0;
        }
        
        .success-icon {
            color: #28a745;
        }
        
        .error-icon {
            color: #dc3545;
        }
        
        .btn {
            display: inline-block;
            background-color: #4a2d8b;
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-weight: 600;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3a2370;
        }
        
        .details {
            margin-top: 20px;
            text-align: left;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .details h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .details-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .details-label {
            font-weight: 600;
            color: #666;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Replace with your actual logo -->
            <img src="https://sportlazestr.blob.core.windows.net/lounge-icons/basketball_big.jpg/120x60?text=SportLaze" alt="SportLaze Logo" class="logo">
            
            <h1>Payment Confirmation</h1>
            
            <div id="loading-state">
                <div class="loading"></div>
                <p class="status">Verifying your payment...</p>
            </div>
            
            <div id="success-state" class="hidden">
                <div class="success-icon">✓</div>
                <h2>Payment Successful!</h2>
                <p>Your ad campaign has been activated and is now running.</p>
                <div class="details">
                    <h2>Payment Details</h2>
                    <div class="details-row">
                        <span class="details-label">Amount:</span>
                        <span id="amount">₦0.00</span>
                    </div>
                    <div class="details-row">
                        <span class="details-label">Reference:</span>
                        <span id="reference-success">-</span>
                    </div>
                    <div class="details-row">
                        <span class="details-label">Date:</span>
                        <span id="date">-</span>
                    </div>
                </div>
            </div>
            
            <div id="error-state" class="hidden">
                <div class="error-icon">✗</div>
                <h2>Payment Failed</h2>
                <p id="error-message">We couldn't verify your payment. Please try again or contact support.</p>
                <p class="reference">Reference: <span id="reference-error">-</span></p>
            </div>
            
            <a href="#" id="dashboard-btn" class="btn hidden">Go to Dashboard</a>
            <a href="#" id="retry-btn" class="btn hidden">Try Again</a>
        </div>
    </div>

    <script>
        // Get URL parameters
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const pairs = queryString.split('&');
            
            for (const pair of pairs) {
                const [key, value] = pair.split('=');
                params[decodeURIComponent(key)] = decodeURIComponent(value || '');
            }
            
            return params;
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-NG', {
                style: 'currency',
                currency: 'NGN',
                minimumFractionDigits: 2
            }).format(amount);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Show appropriate state
        function showState(state) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('success-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('dashboard-btn').classList.add('hidden');
            document.getElementById('retry-btn').classList.add('hidden');
            
            document.getElementById(state).classList.remove('hidden');
            
            if (state === 'success-state') {
                document.getElementById('dashboard-btn').classList.remove('hidden');
            } else if (state === 'error-state') {
                document.getElementById('retry-btn').classList.remove('hidden');
            }
        }
        
        // Verify payment
        async function verifyPayment(reference) {
    try {
        // Get auth token from localStorage or wherever you store it
        const token = localStorage.getItem('authToken');
        
        // Call your backend API
        const response = await fetch(`https://lazeapi-v1-1.onrender.com/v1/ads/payment/verify/${reference}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });
        
        const data = await response.json();
        
        if (data.status === 'success' && data.data.status === 'success') {
            // Update UI with payment details
            document.getElementById('amount').textContent = formatCurrency(data.data.amount / 100);
            document.getElementById('reference-success').textContent = data.data.reference;
            document.getElementById('date').textContent = formatDate(data.data.paid_at);
            
            showState('success-state');
        } else {
            // Show error state
            document.getElementById('error-message').textContent = data.message || "Payment verification failed";
            document.getElementById('reference-error').textContent = reference;
            
            showState('error-state');
        }
    } catch (error) {
        console.error('Error verifying payment:', error);
        document.getElementById('error-message').textContent = "An error occurred while verifying your payment";
        document.getElementById('reference-error').textContent = reference;
        
        showState('error-state');
    }
}
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const params = getUrlParams();
            const reference = params.reference || params.trxref || 'unknown';
            
            // Set up button links
            // document.getElementById('dashboard-btn').href = '/dashboard'; // Change to your actual dashboard URL
            // document.getElementById('retry-btn').href = '/create-ad'; // Change to your ad creation page
            
            // Verify the payment
            verifyPayment(reference);
        });
    </script>
</body>
</html>
